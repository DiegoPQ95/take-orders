(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{5564:function(e,t,a){e.exports=a(5915)},5915:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(34),i=a.n(r),l=a(71),c=a(44),s=a(19),d=a(11),u=a(12),h=a(14),m=a(13),p=a(15),g=a(4),v=a(2),f=a(172),b=a(70),E=a(20),y=function(e,t){for(var a={detalle:e,base0:0,baseIva:0,subtotal:0,iva:0,servicio:0,descuentoTotal:0,total:0},n=0;n<e.length;n++){var o=e[n];if(o.cantidad>0){var r=o.cantidad*o.pvp;o.pagaIva?a.baseIva=a.baseIva+r:a.base0=a.base0+r}}a.base0=a.base0.round(2);var i=0,l=0;t&&a.baseIva&&(i=a.baseIva*t/100,l=a.baseIva,a.iva=i.round(2)),a.baseIva=a.baseIva.round(2);var c=(i+l).round(2),s=a.baseIva+a.iva;return.01===(s-c).round(2)&&(console.info("Le quito un centavo por diferencia",c,s),a.baseIva=a.baseIva-.01),a.servicio=a.servicio.round(2),a.subtotal=(a.base0+a.baseIva).round(2),a.total=a.subtotal+a.servicio+a.iva+(isNaN(a.propina)?0:a.propina),a.total=a.total.round(2),a},O="https://orders.runfoodapp.com/data/";function C(){for(var e=window.location.pathname.split("/"),t=0;t<e.length;t++)if(0===e[t].indexOf("@"))return e[t].replace(/#/g,"").replace("@","");return""}function j(e,t){return fetch(e,t||{method:"GET",cache:"reload",mode:"cors"}).then(function(e){return e.ok?e.json():e.clone().json().catch(function(){return e.text().then(function(t){throw{message:t,status:e.status,statusText:e.statusText}})}).then(function(t){throw Object(s.a)({},t,{status:e.status,statusText:e.statusText})})}).catch(function(e){if("Failed to fetch"===e.message)throw{message:"Este servicio no se encuentra disponible por el momento. Intentelo m\xe1s tarde.",status:0};throw e.message||(e.message=e.statusText),e})}var x={GetProducts:function(){return j(O+C()+"/product")},GetProduct:function(e){return j(O+C()+"/product/"+e)},SaveOrder:function(e){var t=e.contactData,a=e.direccion,n=e.invoiceData,o=e.items,r=e.envio_programado,i=e.delivery;t||(t={}),a||(a={}),n||(n={});var l=(new Date).valueOf()-e.start_timestamp,d=Object(c.a)(o);i&&i.valor&&d.push({id:"domicilio",pvp:i.valor,pagaIva:0});var u=y(d,e.store.porcentajeIVA);u.detalle=o;var h=Object(s.a)({},t,{nota:e.nota,forma_pago:e.forma_pago,numeroTransaccion:e.numeroTransaccion,lat:a&&a.position&&a.position.lat,lng:a&&a.position&&a.position.lng,direccion:a.direccion,referencia:a.referencia,envio_programado:r,valor_delivery:i&&i.valor,mts_delivery:i&&i.metros,segs_delivery:i&&i.segundos,info_id:i&&i.info_id,documento_factura:n.documento,identificacion_factura:n.identificacion,razonsocial_factura:n.razonSocial,direccion_factura:n.direccion,telefono_factura:n.telefono,email_factura:n.email},u,{taking_order_time:l});return j(O+C()+"/order",{body:JSON.stringify(h),method:"POST",mode:"cors",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}})},GetStoreData:function(){return j(O+C()+"?withgooglemapskey=1")},CheckCoverage:function(e){return j(O+C()+"/check-coverage?lat=".concat(e.lat,"&lng=").concat(e.lng))},RedirectTo:function(e,t){var a=window.location.href.split("/@"+C())[0]+"/@"+e;t&&(a+="?step1="+btoa(JSON.stringify(t))+"#/1"),window.location.replace(a)}};function D(e,t){window.localStorage.setItem(e,t),console.log("Preferences."+e+" stored")}function I(e){var t=window.localStorage.getItem(e);try{t=JSON.parse(t)}catch(a){console.warn("Preferences."+e,a)}return"true"===t||"false"===t?"true"===t:(console.log("Preferences."+e+" sent",t),null===t||void 0===t?null:t)}var S=function e(){Object(d.a)(this,e),this.activeStep=0,this.items=[],this.productList=[],this.forma_pago=1,this.numeroTransaccion=null,this.nota="",this.delivery=null,this.contactData={telefono:"",nombre:"",email:"",documento:2,identificacion:""},this.invoiceData=null,this.direccion={direccion:"",referencia:"",position:null},this.envio_programado=null,this.start_timestamp=(new Date).valueOf(),this.orderNumber=null},k=a(43),w=a(35),_=function(e){function t(e){var a;if(Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={nombre:"",descripcion:"",pvp_final:0,cantidad:1,imgSrc:"",nota:"",loading:!0},a.handleInput=a.handleInput.bind(Object(g.a)(Object(g.a)(a))),a.handleDone=a.handleDone.bind(Object(g.a)(Object(g.a)(a))),a.handleCantidad=a.handleCantidad.bind(Object(g.a)(Object(g.a)(a))),a.handleExit=a.handleExit.bind(Object(g.a)(Object(g.a)(a))),a.ID=e.match.params.id,e.choosenItems&&e.choosenItems.length){var n=e.choosenItems.find(function(e){return e.id===+a.ID});n&&(a.state=Object(s.a)({},n,{loading:!1}))}return a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(this.state.loading){var t=this.props.productList;if(t&&t.length){var a=t.find(function(t){return t.id===+e.ID});if(a)return this.setState(Object(s.a)({loading:!1},a))}alert("No se encontr\xf3 el producto en la lista. Recargue la pantalla.")}}},{key:"handleCantidad",value:function(e){var t=e.currentTarget.name;this.setState(function(e){var a=Object(s.a)({},e),n=a.cantidad;return"add"===t&&(n=(n||0)+1),"remove"===t&&(n=n<=0?0:n-1),a.cantidad=n,console.log("Product Details new cantidad ",n),a})}},{key:"handleInput",value:function(e){var t=e.target;this.setState(Object(w.a)({},t.name,t.value))}},{key:"handleDone",value:function(){this.props.onDone(Object(s.a)({},this.state)),this.handleExit()}},{key:"handleExit",value:function(){var e=this.props,t=e.match,a=e.history,n=t.path.substr(0,t.path.indexOf("/view-product/:id"));a.push(n)}},{key:"render",value:function(){console.log("Product Details rendered");var e=this.state;return o.a.createElement(o.a.Fragment,null,e.loading&&o.a.createElement(v.e,{open:!0,classes:{paper:this.props.classes.loadingPaper}},o.a.createElement("div",{style:{marginTop:100,marginBottom:100,textAlign:"center"}},o.a.createElement(v.d,{size:30}),o.a.createElement(v.v,{variant:"h5"},"Cargando..."))),o.a.createElement(v.e,{open:!e.loading,classes:{paper:this.props.classes.dialogPaper}},o.a.createElement(v.g,{style:{padding:0,maxWidth:350,maxHeight:"100%"}},o.a.createElement(v.i,{onClick:this.handleExit,color:"secondary",style:{float:"right",right:10,top:10,position:"absolute"}},o.a.createElement(E.e,null)),o.a.createElement("img",{style:{maxWidth:"100%",maxHeight:"40%"},src:e.imgSrc||"",alt:e.nombre}),o.a.createElement("div",{style:{width:"100%",display:"flex",flexDirection:"row"}},o.a.createElement(v.v,{style:{margin:10,flex:1},variant:"title"},e.nombre),o.a.createElement(v.v,{style:{margin:10},variant:"title"},"$ ",e.pvp_final.toFixed(2))),o.a.createElement(v.v,{style:{margin:10},variant:"body2"},e.descripcion),o.a.createElement("div",{style:{width:"100%",textAlign:"center",marginTop:20,marginBottom:20}},o.a.createElement(P,{onClick:this.handleCantidad,name:"add"},o.a.createElement(E.a,null)),o.a.createElement(v.v,{style:{display:"inline-block",marginLeft:20,marginRight:20},variant:"h6"},e.cantidad||0),o.a.createElement(P,{disabled:e.cantidad<=0,onClick:this.handleCantidad,name:"remove"},o.a.createElement(E.q,null))),o.a.createElement("div",{style:{width:"95%",margin:"auto"}},o.a.createElement(v.u,{value:e.nota,inputProps:{maxLength:200},onChange:this.handleInput,name:"nota",color:"default",placeholder:"Ej. Sin Salsa, verduras aparte, etc.",label:"Agrega una nota:",variant:"outlined",multiline:!0,rows:"3",fullWidth:!0}))),o.a.createElement(v.f,null,o.a.createElement(v.a,{type:"button",onClick:this.handleDone,color:"primary",variant:"outlined"},"AGREGAR"))))}}]),t}(o.a.Component),T=Object(k.withStyles)(function(e){return{dialogPaper:{maxWidth:450,maxHeight:"calc(100% - 20px)",marginTop:10,marginBottom:10},loadingPaper:{marginLeft:10,marginRight:10,width:"calc(100% - 20px)",maxWidth:450}}})(Object(f.h)(_));function P(e){var t={height:50,width:50,border:"1px solid gray"};return e.disabled&&delete t.border,o.a.createElement(v.m,{disabled:e.disabled,onClick:e.onClick,name:e.name,style:t},e.children)}var R={root:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",overflow:"hidden"},gridList:{flexWrap:"nowrap",transform:"translateZ(0)"}},A=function(e){function t(e){var a;return Object(d.a)(this,t),a=Object(h.a)(this,Object(m.a)(t).call(this,e)),e.onMounted&&e.onMounted(e.stepIndex),a.handleClick=a.handleClick.bind(Object(g.a)(Object(g.a)(a))),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"handleClick",value:function(e){this.props.history.push(this.props.match.path+"/view-product/"+e.currentTarget.id)}},{key:"render",value:function(){var e=this;console.log("TakeOrder rendered");var t=this.props,a=t.productList,n=t.style,r=t.choosenItems,i=t.match,l=t.onItemChange,c=a.reduce(function(e,t){var a=e.find(function(e){return e.group===t.grupo});return a||(a={group:t.grupo,id:t.idGrupo,orden:t.grupo_orden,items:[]},e.push(a)),a.items.push(t),e},[]);return c&&c.length?o.a.createElement("div",{style:Object(s.a)({},n,{textAlign:"left",overflowX:"hidden",overflowY:"auto"})},c.sort(function(e,t){return e.orden-t.orden}).map(function(t,a){return o.a.createElement(M,{key:t.id||a,onClick:e.handleClick,style:{marginTop:10,marginBottom:10},title:t.group,items:t.items,choosenItems:r})}),o.a.createElement(f.c,{path:i.path+"/view-product/:id"},o.a.createElement(T,{choosenItems:r||[],onDone:l,productList:a}))):o.a.createElement("div",{style:Object(s.a)({},n,{textAlign:"center"})},o.a.createElement(v.v,{variant:"h6"},"Esta tienda no tiene productos disponibles. Intenta nuevamente despu\xe9s."))}}]),t}(o.a.PureComponent),M=Object(k.withStyles)({tile_no_disponible:{"&::before":{background:"#b3b1b1d4",position:"absolute",top:0,left:0,height:"100%",width:"100%",content:'"NO DISPONIBLE"',zIndex:100,color:"white",paddingTop:60,fontSize:"calc(1em + 1vw)",fontWeight:"bolder",fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif',textAlign:"center"}}})(function(e){return o.a.createElement("div",{style:Object(s.a)({},e.style)},o.a.createElement(v.v,{variant:"h6",style:{marginLeft:10}},e.title),o.a.createElement(v.j,{cols:2.5,style:R.gridList},e.items.sort(function(e,t){return e.orden-t.orden}).map(function(t){var a=(e.choosenItems||[]).find(function(e){return e.id===t.id});return function(e,t,a,n){var r={title:e.nombre,actionPosition:"right",subtitle:"$ "+e.pvp_final.toFixed(2)};t&&(r.actionIcon=o.a.createElement(v.v,{variant:"body2",style:{color:"#fff",marginRight:5}},"x",t));var i={cursor:"pointer"};t&&(i.border="3px dashed #f50057");e.paused&&console.info("Item paused",n);return o.a.createElement(v.k,{classes:{tile:e.paused?n.tile_no_disponible:null},style:i,key:e.id,onClick:function(t){return e.paused?alert("Este item no est\xe1 disponible"):a(t)},id:e.id,color:"inherit",disabled:!e.paused},o.a.createElement("img",{src:e.imgSrc,alt:e.nombre}),o.a.createElement(v.l,r))}(t,a&&a.cantidad,e.onClick,e.classes)})))});function L(e){return 0===e?"Dom":1===e?"Lun":2===e?"Mar":3===e?"Mie":4===e?"Jue":5===e?"Vie":6===e?"Sab":7===e?"Dom":void 0}function N(e){var t=[];if(e&&e.length)for(var a=0;a<e.length;a++){var n,o=e[a],r=o.dias.map(function(e){return 0===e?7:e}).sort(function(e,t){return e-t}),i=r.length>1&&r.filter(function(e,t){return 0===t||r[t-1]===e-1}).length===r.length,l=B(o);n=i?L(r[0])+" - "+L(r[r.length-1]):r.map(function(e){return L(e)}).join(", "),t.push({periodo:l,dias:n})}return t}function B(e){var t=e.tz,a=e.desde,n=e.hasta,o=new Date,r=(a=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),a[0],parseInt(a[1])+parseInt(t),59)),n=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),n[0],parseInt(n[1])+parseInt(t),59)),"");return a.getDay()<n.getDay()&&(r="+"+(n.getDay()-a.getDay())),a.toLocaleTimeString().replace(/:59/g,"")+" - "+n.toLocaleTimeString().replace(/:59/g,"")+r}function F(e,t){var a=[],n=(new Date).getTimezoneOffset();if(e&&e.length)for(var o=0;o<e.length;o++){var r=e[o],i=r.dias.sort(function(e,t){return e-t}),l=60*r.desde[0]+r.desde[1]+r.tz-n,c=60*r.hasta[0]+r.hasta[1]+r.tz-n;i.forEach(function(e){var t=a.find(function(t){return t.day===e});t||(t={day:e,horas:[]},a.push(t));for(var n=l;n<=c;n+=15)t.horas.indexOf(n)<0&&t.horas.push(n)})}var d=[];t||(t=7);for(var u=new Date,h=0;t;){h++;var m=new Date(u.getFullYear(),u.getMonth(),u.getDate()+h,u.getHours(),u.getMinutes()),p=a.find(function(e){return e.day===m.getDay()}),g=[m.getFullYear(),m.getMonth(),m.getDate(),m.getTimezoneOffset()].join("-");a.length?p&&(d.push(Object(s.a)({},p,{Date:m,day:g})),t--):(d.push({day:g,Date:m}),t--)}return d}window.HorariosToDias=F;var U=function(e){function t(e){var a;if(Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={dia:"",hora:"",dias:[]},a.handleDia=a.handleDia.bind(Object(g.a)(Object(g.a)(a))),a.handleHora=a.handleHora.bind(Object(g.a)(Object(g.a)(a))),a.handleClose=a.handleClose.bind(Object(g.a)(Object(g.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(g.a)(Object(g.a)(a))),e.value)for(var n in a.state)e.value.hasOwnProperty(n)&&(a.state[n]=e.value[n]);return a.state.dias=F(e.store&&e.store.horarios,7),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"handleDia",value:function(e){var t=e.currentTarget.value;this.setState({dia:t});var a=W(t,this.state.dias);a&&a.length&&a.indexOf(+this.state.hora)>=0||this.setState({hora:null})}},{key:"handleHora",value:function(e){var t=e.currentTarget.value;this.setState({hora:t})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.onDone&&this.props.onDone({dia:this.state.dia,hora:this.state.hora})}},{key:"handleClose",value:function(){this.props.onDone&&this.props.onDone(this.props.value)}},{key:"render",value:function(){var e=this.state,t=e.dia,a=e.hora,n=this.state.dias&&this.state.dias.length&&this.state.dias||[],r=[{value:"",label:"Cualquier hora"}].concat(Object(c.a)(W(t,n))),i=[{day:"",label:"Elige un d\xeda"}].concat(Object(c.a)(n));return o.a.createElement(v.e,{open:!0,onClose:this.handleClose},o.a.createElement("form",{onSubmit:this.handleSubmit},o.a.createElement(v.g,null,o.a.createElement(v.v,{variant:"h6"},"Elige el horario para tu entrega:"),o.a.createElement(v.u,{select:!0,value:t||"",onChange:this.handleDia,variant:"outlined",style:{width:"95%",margin:"auto",marginBottom:10,marginTop:10},SelectProps:{native:!0}},i.map(function(e){return o.a.createElement("option",{value:e.day},e.label||e.Date.toDateString())})),r&&r.length&&o.a.createElement(v.u,{select:!0,value:a||"",onChange:this.handleHora,variant:"outlined",style:{width:"95%",margin:"auto",marginBottom:10,marginTop:10},SelectProps:{native:!0}},r.map(function(e){return o.a.createElement("option",{value:e.value},e.label)}))),o.a.createElement(v.f,null,o.a.createElement(v.a,{type:"submit"},"GUARDAR"))))}}]),t}(o.a.PureComponent);function W(e,t){var a=e&&t.find(function(t){return t.day===e});return a&&a.horas&&a.horas.map(function(e){var t=e/60,a=parseInt(t),n=t>a?60*(t-a):0,o=0;return a>23&&(o++,a-=24),{value:e,label:"".concat(1===a.toString().length?"0":"").concat(a)+":"+"".concat(1===n.toString().length?"0":"").concat(n," ").concat(o?"+"+o:"")}})||[]}var z=function(e){function t(e){var a;return Object(d.a)(this,t),a=Object(h.a)(this,Object(m.a)(t).call(this,e)),e.onMounted&&e.onMounted(e.stepIndex),a.handleClick=a.handleClick.bind(Object(g.a)(Object(g.a)(a))),a.handleEnvio=a.handleEnvio.bind(Object(g.a)(Object(g.a)(a))),a.programarEnvio=a.programarEnvio.bind(Object(g.a)(Object(g.a)(a))),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"handleClick",value:function(e){var t=e.currentTarget.id;this.props.history.push(this.props.match.url+"/view-product/"+t)}},{key:"programarEnvio",value:function(e){this.props.onDataChange&&this.props.onDataChange("envio_programado",e),this.props.history.push(this.props.match.path)}},{key:"handleEnvio",value:function(e){e.currentTarget.value?this.props.history.push(this.props.match.path+"/schedule"):this.programarEnvio()}},{key:"render",value:function(){var e=this;console.log("ConfirmOrder rendered");var t=this.props,a=(t.delivery||{}).valor,n=(t.delivery||{}).status;return o.a.createElement("div",{style:{paddingLeft:10,paddingRight:10,overflow:"auto",flex:1}},o.a.createElement(v.o,{style:{marginBottom:10},dense:!0},t.items.map(function(t){return G(t,e.handleClick)}),"ACTIVO"!==n||isNaN(+a)?null:G({id:"DOMICILIO",nombre:"ENVIO A DOMICILIO",pvp_final:a,cantidad:1}),function(e,t,a){var n=Object(c.a)(e);t&&n.push({id:"DOMICILIO",cantidad:1,pvp:t,pagaIva:!1});var r=y(n,a);return o.a.createElement(v.p,null,o.a.createElement("div",{style:{display:"table",width:"100%"}},o.a.createElement("div",{style:{display:"table-cell",paddingRight:5}},o.a.createElement(v.v,{variant:"h6"},"TOTAL")),o.a.createElement("div",{style:{display:"table-cell",width:"15%",maxWidth:100,textAlign:"right"}}),o.a.createElement("div",{style:{display:"table-cell",width:"25%",maxWidth:100,minWidth:75,textAlign:"right"}},o.a.createElement(v.v,{style:{margin:0,padding:0},variant:"h6"},"$ ",r.total.round(2).toFixed(2)))))}(t.items,a,t.store.porcentajeIVA)),"ACTIVO"!==n?o.a.createElement(v.v,{variant:"subtitle1",color:"secondary"},"El costo del Env\xedo a Domicilio no est\xe1 disponible. Debes consultar este valor con la tienda."):null,o.a.createElement("div",{style:{width:"100%",textAlign:"center"}},o.a.createElement(v.u,{label:"Agrega una nota a tu pedido",placeholder:"Ej. Sin cubiertos, sin salas extra, etc.",multiline:!0,name:"nota",inputProps:{maxLength:200},value:t.nota,onChange:t.onInputChange,rows:2,style:{width:"95%",margin:"auto",marginBottom:10,marginTop:10}}),o.a.createElement("div",{style:{width:"95%",display:"flex",flexDirection:"row",marginTop:10}},"ACTIVO"===t.store.estado&&o.a.createElement(v.a,{color:t.envio_programado?"default":"primary",style:{flex:1,marginRight:5},variant:t.envio_programado?"outlined":"contained",onClick:this.handleEnvio,value:""},"Entrega inmediata"),o.a.createElement(v.a,{color:t.envio_programado?"primary":"default",style:{flex:1,marginLeft:5},variant:t.envio_programado?"contained":"outlined",onClick:this.handleEnvio,value:"1"},t.envio_programado?"Entrega programada":"Programa la Entrega"))),o.a.createElement(f.c,{path:t.match.path+"/view-product/:id"},o.a.createElement(T,{productList:t.productList,choosenItems:t.items||[],onDone:t.onItemChange})),o.a.createElement(f.c,{path:t.match.path+"/schedule"},o.a.createElement(U,{store:t.store,value:t.envio_programado,onDone:this.programarEnvio})))}}]),t}(o.a.PureComponent);function G(e,t){var a="DOMICILIO"===e.id?"primary":"default";return o.a.createElement(v.p,{key:e.id,button:Boolean(t),onClick:t,id:e.id},o.a.createElement("div",{style:{display:"table",width:"100%"}},o.a.createElement("div",{style:{display:"table-cell",paddingRight:5}},o.a.createElement(v.v,{color:a,variant:"subtitle1"},e.nombre),e.nota&&o.a.createElement(v.v,{color:a,variant:"body1"},e.nota)),o.a.createElement("div",{style:{display:"table-cell",width:"15%",maxWidth:100,textAlign:"right"}},o.a.createElement(v.v,{color:a,variant:"h6",style:{margin:0,padding:0}},"x",e.cantidad)),o.a.createElement("div",{style:{display:"table-cell",width:"25%",maxWidth:100,minWidth:75,textAlign:"right"}},o.a.createElement(v.v,{color:a,variant:"h6",style:{margin:0,padding:0}},"$ ",(e.pvp_final*e.cantidad).round(2).toFixed(2)))))}var H=function(e,t){if(e||(e=""),3!==(t=+t)){if(1===t){if(13!==e.length)return"N\xfamero de RUC debe tener 13 digitos";if(13===e.length&&"9999999999999"===e)return}return 2===t&&10!==e.length?"N\xfamero de Cedula debe tener 10 digitos":function(e,t,a,n){var o="",r=!1;if(t&&(A=e,""===A||void 0==A||null==A||"undefined"==A))o="",r=!0;else if(function(e){return!isNaN(parseFloat(e))}(e)){e.length<10?o="El numero de Cedula debe tener 10 d\xedgitos":e.length>10&&e.length<13?o="El numero de RUC debe tener 13 d\xedgitos":e.length>13&&(o="El numero tiene m\xe1s de 13 d\xedgitos");var i,l,c,s,d,u,h,m,p,g=0,v=!1,f=!1,b=!1,E=11,y=e.substr(0,1),O=e.substr(1,1),C=e.substr(2,1),j=e.substr(3,1),x=e.substr(4,1),D=e.substr(5,1),I=e.substr(6,1),S=e.substr(7,1),k=e.substr(8,1),w=e.substr(9,1);if(V(y)||(o="El digito 1 no es un n\xfamero"),V(O)||(o="El digito 2 no es un n\xfamero"),V(C)||(o="El digito 3 no es un n\xfamero"),V(j)||(o="El digito 4 no es un n\xfamero"),V(x)||(o="El digito 5 no es un n\xfamero"),V(D)||(o="El digito 6 no es un n\xfamero"),V(I)||(o="El digito 7 no es un n\xfamero"),V(S)||(o="El digito 8 no es un n\xfamero"),V(k)||(o="El digito 9 no es un n\xfamero"),V(w)||(o="El digito 10 no es un n\xfamero"),e.length>10){var _=e.substr(10,1),T=e.substr(10,1),P=e.substr(10,1);_&&!V(_)&&(o="El digito 11 no es un n\xfamero"),T&&!V(T)&&(o="El digito 12 no es un n\xfamero"),P&&!V(P)&&(o="El digito 13 no es un n\xfamero")}7!=C&&8!=C||(o="El tercer d\xedgito ingresado es inv\xe1lido",r=!1),C<6?(b=!0,(i=2*y)>=10&&(i-=9),(l=1*O)>=10&&(l-=9),(c=2*C)>=10&&(c-=9),(s=1*j)>=10&&(s-=9),(d=2*x)>=10&&(d-=9),(u=1*D)>=10&&(u-=9),(h=2*I)>=10&&(h-=9),(m=1*S)>=10&&(m-=9),(p=2*k)>=10&&(p-=9),E=10):6==C?(f=!0,i=3*y,l=2*O,c=7*C,s=6*j,d=5*x,u=4*D,h=3*I,m=2*S,p=0):9==C&&(v=!0,i=4*y,l=3*O,c=2*C,s=7*j,d=6*x,u=5*D,h=4*I,m=3*S,p=2*k);var R=0==(g=(i+l+c+s+d+u+h+m+p)%E)?0:E-g;1==f?(R!=k&&(o="El ruc de la empresa del sector p\xfablico es incorrecto.",r=!1),"0001"!=e.substr(9,4)&&(o="El ruc de la empresa del sector p\xfablico debe terminar con 0001",r=!1)):1==v?(R!=w&&(o="El ruc de la empresa del sector privado es incorrecto.",r=!1),"001"!=e.substr(10,3)&&(o="El ruc de la empresa del sector privado debe terminar con 001",r=!1)):1==b&&(R!=w&&(o="El n\xfamero de c\xe9dula de la persona natural es incorrecto.",r=!1),e.length>10&&"001"!=e.substr(10,3)&&(o="El ruc de la persona natural debe terminar con 001",r=!1)),r=!0}else o="Este campo solo admite numeros";var A;return r&&""==o?(a&&a(),""):(""==o&&(o="La cantidad de digitos no corresponde a Cedula o RUC"),n&&n(o),o)}(e,!1)}};function V(e){return e>="0"&&e<="9"}var q={tel:function(e){if(e){if(e.length<7)return"El n\xfamero de telefono debe tener al menos 7 digitos";for(var t=0;t<e.length;t++)if("+"!==e[t]&&!V(e[t])&&""!==e[t].trim())return"El n\xfamero debe tener uno de estos formatos: '09123456789' o '+5931234567890'"}},email:function(e){if(e){if(e.length<5)return"El email no est\xe1 escrito correctamente";var t=e.split("@");return 2!==t.length?"El email no est\xe1 escrito correctamente":t[1].indexOf(".")>=0?e.trim().indexOf(" ")>=0?"El email no est\xe1 escrito correctamente":e.trim().indexOf("\t")>=0?"El email no est\xe1 escrito correctamente":e.trim().indexOf("\r")>=0?"El email no est\xe1 escrito correctamente":void 0:"El email no est\xe1 escrito correctamente"}}},J={textField:{marginTop:10,marginBottom:10},content:{paddingTop:10,paddingLeft:10,paddingRight:10,paddingBottom:0}},Y=function(e){function t(e){var a;if(Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={documento:1,identificacion:"",razonSocial:"",telefono:"",direccion:"",email:""},e.data)for(var n in e.data)e.data.hasOwnProperty(n)&&(a.state[n]=e.data[n]);else{var o=I("invoiceData");if(o)for(var r in o)o.hasOwnProperty(r)&&(a.state[r]=o[r])}return a.handleChange=a.handleChange.bind(Object(g.a)(Object(g.a)(a))),a.handleExit=a.handleExit.bind(Object(g.a)(Object(g.a)(a))),a.handleDone=a.handleDone.bind(Object(g.a)(Object(g.a)(a))),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"handleChange",value:function(e){var t=e.target,a=t.name,n=t.value;this.setState(Object(w.a)({},a,n))}},{key:"handleExit",value:function(){var e=this.props,t=e.match,a=e.history,n=t.path.substr(0,t.path.indexOf("/invoice-data"));a.push(n)}},{key:"handleDone",value:function(e){e.preventDefault();var t=function(e){var t=e.documento,a=e.identificacion,n=e.razonSocial,o=e.telefono,r=e.direccion,i=e.email,l=a||"",c=n||"",s=o||"",d=r||"",u=i||"",h="";if(l.length||c.length||s.length||d.length||u.length){if(!l.length)return"Agregue el numero de identificacion";if(!c.length)return"Agregue la Razon Social";if(h=H(a,t))return h;if(h=s&&q.tel(s))return h;if(h=u&&q.email(u))return h}}(this.state);t?alert(t):(this.props.onDone&&this.props.onDone(this.state),this.handleExit(),D("invoiceData",this.state))}},{key:"render",value:function(){var e=this.state.identificacion?H(this.state.identificacion,this.state.documento):"",t={};e&&(t.error=!0,t.helperText=e);var a=this.state.identificacion&&!(this.state.razonSocial||"").trim()?"Esta campo no puede estar vac\xedo":"",n={},r=q.tel(this.state.telefono);r&&(n.error=!0,n.helperText=r);var i={},l=q.email(this.state.email);l&&(i.error=!0,i.helperText=l);var c=e||a||r||l;return o.a.createElement(v.e,{open:!0},o.a.createElement("form",{onSubmit:this.handleDone},o.a.createElement(v.g,{style:J.content},o.a.createElement(v.u,{value:this.state.documento,name:"documento",onChange:this.handleChange,select:!0,SelectProps:{native:!0},fullWidth:!0,label:"Documento",style:J.textField},o.a.createElement("option",{value:1},"RUC"),o.a.createElement("option",{value:2},"Cedula"),o.a.createElement("option",{value:3},"Pasaporte")),o.a.createElement(v.u,Object.assign({name:"identificacion",inputProps:{maxLength:20},onChange:this.handleChange,label:"# de Identificacion",value:this.state.identificacion||"",style:J.textField,fullWidth:!0},t)),o.a.createElement(v.u,{name:"razonSocial",inputProps:{maxLength:200},onChange:this.handleChange,label:"Razon Social",value:this.state.razonSocial||"",style:J.textField,fullWidth:!0}),o.a.createElement(v.u,Object.assign({name:"telefono",inputProps:{maxLength:50},onChange:this.handleChange,label:"Telefono",value:this.state.telefono||"",style:J.textField,fullWidth:!0},n)),o.a.createElement(v.u,{name:"direccion",inputProps:{maxLength:300},onChange:this.handleChange,label:"Direccion",value:this.state.direccion||"",multiline:!0,rows:2,style:J.textField,fullWidth:!0}),o.a.createElement(v.u,Object.assign({name:"email",inputProps:{maxLength:150},onChange:this.handleChange,label:"Email",value:this.state.email||"",style:J.textField,fullWidth:!0},i))),o.a.createElement(v.f,null,o.a.createElement(v.a,{type:"button",onClick:this.handleExit,color:"secondary",variant:"outlined"},"SALIR"),o.a.createElement(v.a,{disabled:c,type:"submit",color:"primary",variant:"outlined"},"AGREGAR"))))}}]),t}(o.a.PureComponent);var Z,Q=Object(k.withStyles)(function(e){return{paper:{maxHeight:"calc(100% - 30px)",marginTop:15,marginBottom:15}}})(Y),$={root:{padding:"20px 10px",flex:1},textFiel:{marginTop:10,marginBottom:10}},K=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={telefono_error:"",email_error:""},e.onMounted&&e.onMounted(e.stepIndex),a.handleClick=a.handleClick.bind(Object(g.a)(Object(g.a)(a))),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"handleClick",value:function(e){e.currentTarget.value?this.props.history.push(this.props.match.path+"/invoice-data"):this.props.onInvoiceDataChange(null)}},{key:"render",value:function(){var e,t=this.props,a=q.tel(t.data.telefono),n={};a&&(n.error=!0,n.helperText=a);var r=q.email(t.data.email),i={};r&&(i.error=!0,i.helperText=r);var l=t.data.identificacion?H(t.data.identificacion,t.data.documento):"",c={};return l&&(c.error=!0,c.helperText=l),o.a.createElement("div",{style:$.root},t.requireContactCedula&&o.a.createElement(o.a.Fragment,null,o.a.createElement(v.u,{autoFocus:!0,label:"Documento",fullWidth:!0,style:$.textField,name:"contactData.documento",select:!0,SelectProps:{native:!0},value:t.data.documento||1,onChange:t.onInputChange},o.a.createElement("option",{value:1},"RUC"),o.a.createElement("option",{value:2},"Cedula"),o.a.createElement("option",{value:3},"Pasaporte")),o.a.createElement(v.u,Object.assign((e={inputProps:{maxLength:20},label:"# Identificaci\xf3n*",fullWidth:!0},Object(w.a)(e,"inputProps",{maxLength:300}),Object(w.a)(e,"style",$.textField),Object(w.a)(e,"name","contactData.identificacion"),Object(w.a)(e,"value",t.data.identificacion||""),Object(w.a)(e,"onChange",t.onInputChange),e),c))),o.a.createElement(v.u,{autoFocus:!t.requireContactCedula,label:"Nombre (Nombres y Apellidos)*",fullWidth:!0,inputProps:{maxLength:300},style:$.textField,name:"contactData.nombre",value:t.data.nombre,onChange:t.onInputChange}),o.a.createElement(v.u,Object.assign({label:"Telefono*",fullWidth:!0,inputProps:{maxLength:50,type:"phone"},style:$.textField,name:"contactData.telefono",value:t.data.telefono,onChange:t.onInputChange},n)),o.a.createElement(v.u,Object.assign({label:"Email",fullWidth:!0,inputProps:{maxLength:150,type:"email"},style:$.textField,name:"contactData.email",value:t.data.email,onChange:t.onInputChange},i)),o.a.createElement(v.v,{variant:"h6",style:{marginTop:10,marginBottom:10}},"Datos de Facturaci\xf3n"),o.a.createElement("div",{style:{width:"95%",marginBottom:10,textAlign:"center",display:"flex",flexDirection:"row"}},o.a.createElement(v.a,{variant:t.invoiceData?"outlined":"contained",color:t.invoiceData?"default":"primary",onClick:this.handleClick,value:"",style:{flex:1,marginRight:10}},"CONSUMIDOR FINAL"),o.a.createElement(v.a,{variant:t.invoiceData?"contained":"outlined",color:t.invoiceData?"primary":"default",size:"small",value:"1",style:{flex:1,marginLeft:10},onClick:this.handleClick},t.invoiceData&&t.invoiceData.razonSocial||"Agregar Datos")),o.a.createElement(f.c,{path:"".concat(t.match.path,"/invoice-data"),render:function(e){return o.a.createElement(Q,Object.assign({},e,{data:t.invoiceData,onDone:t.onInvoiceDataChange}))}}))}}]),t}(o.a.Component),X=a(114),ee=a(299),te=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,null,[{key:"currentPosition",value:function(){return new Promise(function(e,t){if(console.info("obteniendo posicion actual con navigator.geolocation.getCurrentPosition"),!navigator.geolocation)return console.info("navigator.geolocation.getCurrentPosition no existe en este navegador, intentando con PositionByIP()"),ae().then(e).catch(t);navigator.geolocation.getCurrentPosition(function(t){console.info("navigator.geolocation.getCurrentPosition ha obtenido la posicion"),e({lat:t.coords.latitude,lng:t.coords.longitude},!0)},function(){console.info("navigator.geolocation.getCurrentPosition fall\xf3, intentando con PositionByIP()"),ae().then(e).catch(t)})})}},{key:"CanUseGPS",value:function(){return new Promise(function(e,t){if(!navigator.geolocation)return t();navigator.geolocation.getCurrentPosition(e,t)})}},{key:"PlaceFromCoords",value:function(e,t){var a=this;return Z||(Z=new window.google.maps.Geocoder),new Promise(function(n,o){Z.geocode({location:e,bounds:t||a.QUITO_BOUNDS},function(e,t){if("ZERO_RESULTS"===t)return o({status:t,message:"No se encontraron resultados"});var a=e.length&&e[0];if(!a)return o({message:"No se encontraron resultados"});a.inputText=function(e){for(var t,a,n=0;n<e.address_components.length;n++)for(var o=e.address_components[n],r=0;r<o.types.length;r++){var i=o.types[r];if("street_address"===i)return o.short_name||o.long_name;if(o.types.find(function(e){return"street_number"===e})&&o.types.find(function(e){return"route"===e}))return o.short_name||o.long_name;"route"!==i||t||(t=o.short_name||o.long_name),"street_number"!==i||a||(a=o.short_name||o.long_name)}return t&&a?t+" "+a:e.formatted_address}(a),n(a)})})}},{key:"CoordsFromPlace",value:function(e,t){var a=this;return Z||(Z=new window.google.maps.Geocoder),new Promise(function(n,o){Z.geocode({address:e,bounds:t||a.QUITO_BOUNDS},function(e,t){if("ZERO_RESULTS"===t)return o({status:t,message:"No se encontraron resultados"});var a=e.length&&e[0];if(!a)return o({message:"No se encontraron resultados"});n(a)})})}}]),e}();function ae(){return fetch("https://ipapi.co/json/").then(function(e){return e.json()}).then(function(e){return{lat:e.latitude,lng:e.longitude}})}te.QUITO_BOUNDS={west:-78.853,north:-.04875,east:-78.17184,south:-.39207},te.QUITO={lat:-.189515,lng:-78.488167};var ne=function(e){function t(e){var a;Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={zoom:15,initial_position:void 0,initial_gps_enabled:void 0},a.placeChanged=a.placeChanged.bind(Object(g.a)(Object(g.a)(a))),a.handleLocationClick=a.handleLocationClick.bind(Object(g.a)(Object(g.a)(a))),a.handleInput=a.handleInput.bind(Object(g.a)(Object(g.a)(a))),a.handleMapMounted=a.handleMapMounted.bind(Object(g.a)(Object(g.a)(a))),a.handleDragEnd=a.handleDragEnd.bind(Object(g.a)(Object(g.a)(a))),a.handleDragStart=a.handleDragStart.bind(Object(g.a)(Object(g.a)(a))),a.handleCenterChanged=a.handleCenterChanged.bind(Object(g.a)(Object(g.a)(a))),a.positionChanged=a.positionChanged.bind(Object(g.a)(Object(g.a)(a))),a.valueChanged=a.valueChanged.bind(Object(g.a)(Object(g.a)(a))),console.info("Location comienza con direccion",e.data);var n=I("direccion");return n&&!e.data.position&&(console.info("Se reemplaza por la direccion en PREFS"),e.onDataChange(e.prop,n),a.state.zoom=17,a.state.initial_position=n),e.data.position&&(a.state.zoom=17,a.state.initial_position=e.data.position),a.state.initial_gps_enabled=e.data&&e.data.gps_enabled,a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.state.initial_position?void 0!==this.state.initial_gps_enabled&&null!==this.state.initial_gps_enabled||(console.info("Se verifica si el GPS se puede usar"),te.CanUseGPS().then(function(){return e.valueChanged("gps_enabled",!0)}).catch(function(){return e.valueChanged("gps_enabled",!1)})):(console.info("No se encuentra la posicion, asi que se busca por GPS/HTTP"),te.currentPosition().then(function(t){console.info("Posicion por GPS/HTTP encontrada"),e.positionChanged(t,!1),e.valueChanged("gps_enabled",!0),e.setState({zoom:17})}).catch(function(t){console.info("Posicion por GPS/HTTP no encontrada"),e.setState({loading:!1}),e.valueChanged("gps_enabled",!1)}))}},{key:"componentWillUnmount",value:function(){this.autocomplete&&this.autocomplete.unbindAll()}},{key:"valueChanged",value:function(e,t){var a=Object(s.a)({},this.props.data);a[e]=t,this.props.onDataChange(this.props.prop,a)}},{key:"positionChanged",value:function(e,t){!t&&this.mapRef&&this.mapRef.getZoom()<17&&this.setState({zoom:17}),this.valueChanged("position",e)}},{key:"handleInput",value:function(e){var t=e.currentTarget,a=t.value,n=t.name;this.valueChanged(n,a)}},{key:"handleCenterChanged",value:function(){this.positionChanged(this.mapRef&&this.mapRef.getCenter().toJSON())}},{key:"placeChanged",value:function(){var e=this,t=this.autocomplete.getPlace();if(!t.geometry)return te.CoordsFromPlace(t.name).then(function(t){return e.positionChanged(t.geometry.location)});this.positionChanged(t.geometry.location),this.valueChanged("direccion",this.autocompleteRef.value)}},{key:"handleLocationClick",value:function(){var e=this;te.currentPosition().then(function(t){e.positionChanged(t),te.PlaceFromCoords(e.props.data.position).then(function(t){return e.valueChanged("direccion",t.inputText)})}).catch(function(e){alert("No pudimos obtener tu ubicacion"),console.warn("handleLocationClick",e)})}},{key:"handleDragStart",value:function(){this.virtualMarker.classList.add("on-move")}},{key:"handleDragEnd",value:function(){var e=this;this.positionChanged(this.mapRef.getCenter().toJSON(),!0),te.PlaceFromCoords(this.mapRef.getCenter()).then(function(t){return e.valueChanged("direccion",t.inputText)}).catch(function(e){return console.warn("PlaceFromCoords ERROR",e)}),this.virtualMarker.classList.remove("on-move")}},{key:"handleMapMounted",value:function(e){this.mapRef=e,this.mapRef&&(this.virtualMarker=document.createElement("div"),this.virtualMarker.className="centerMarker",e.getDiv().appendChild(this.virtualMarker),this.mountAutocomplete())}},{key:"mountAutocomplete",value:function(){var e=this;this.mapRef&&this.autocompleteRef&&(this.autocomplete||(this.props.data.position&&!this.props.data.direccion&&te.PlaceFromCoords(this.props.data.position).then(function(t){return e.valueChanged("direccion",t.inputText)}),this.autocomplete=new window.google.maps.places.Autocomplete(this.autocompleteRef),this.autocomplete.bindTo("bounds",this.mapRef),this.autocomplete.addListener("place_changed",this.placeChanged),this.autocomplete.setOptions({strictBounds:!0})))}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=t.store,r=this.state.zoom;return o.a.createElement("div",{style:{overflow:"auto",paddingLeft:10,paddingRight:10,flex:1}},o.a.createElement("div",{style:{width:"100%",display:"flex",flexDirection:"row"}},o.a.createElement(v.u,{inputRef:function(t){return e.autocompleteRef=t},name:"direccion",inputProps:{maxLength:200},onChange:this.handleInput,value:a.direccion||"",placeholder:"Ej. Calle 1 y Calle 2",label:"Direccion de Entrega*",fullWidth:!0,style:{marginBottom:10,marginTop:5,flex:1},InputProps:{endAdornment:o.a.createElement(v.n,{position:"end"},o.a.createElement(v.m,{onClick:this.handleLocationClick,disabled:!a.gps_enabled},a.gps_enabled?o.a.createElement(E.g,null):o.a.createElement(E.h,null)))}})),o.a.createElement(oe,{googleMapURL:"https://maps.googleapis.com/maps/api/js?key=".concat(n.G_M_K||"","&v=3.exp&libraries=geometry,places,geocode"),containerElement:o.a.createElement("div",{id:"map-container"}),loadingElement:o.a.createElement("div",{style:{height:"100%"}}),mapElement:o.a.createElement("div",{style:{height:"100%"}}),onClick:this.handleMapClick,zoom:r,onZoomChanged:function(){return e.setState({zoom:e.mapRef.getZoom()})},onMapMounted:this.handleMapMounted,center:a.position||n.position,onCenterChanged:this.handleCenterChanged,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,marker:{label:"Tienda",position:n.position}}),o.a.createElement(v.u,{name:"referencia",value:a.referencia||"",onChange:this.handleInput,inputProps:{maxLength:200},label:"Referencia*",placeholder:"Ej. Al lado de la panaderia 'El Pan de Cada Dia'",fullWidth:!0}))}}]),t}(o.a.PureComponent),oe=Object(X.withScriptjs)(Object(X.withGoogleMap)(function(e){var t=window.google,a=e.marker,n=e.onMapMounted,r=Object(l.a)(e,["marker","onMapMounted"]);return o.a.createElement(X.GoogleMap,Object.assign({},r,{ref:n,options:{disableDefaultUI:!0,zoomControl:!0,clickableIcons:!1}}),a&&o.a.createElement(ee.MarkerWithLabel,{labelAnchor:new t.maps.Point(0,0),position:a.position,icon:"./store.png"},o.a.createElement(v.b,{elevation:1,color:"secondary",style:{margin:2}},o.a.createElement(v.c,{style:{maxWidth:200,padding:5}},o.a.createElement(v.v,{variant:"button"},a.label)))))})),re=function(e){function t(){return Object(d.a)(this,t),Object(h.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e,t=this.props;return o.a.createElement("div",{style:{flex:1,textAlign:"center"}},o.a.createElement(v.u,{label:"Selecciona tu m\xe9todo de pago",select:!0,value:t.forma_pago||"",name:"forma_pago",onChange:t.onInputChange,variant:"outlined",style:{width:"95%",margin:"auto",marginBottom:10,marginTop:10},SelectProps:{native:!0}},function(e){var t=[];if(!e)return t;e.indexOf(1)>=0&&t.push({label:"Efectivo",value:1});e.indexOf(2)>=0&&t.push({label:"Tarjeta de Credito/Debito",value:2});e.indexOf(3)>=0&&t.push({label:"Transferencia Bancaria",value:3});return t}(t.store.formasPago).map(function(e){return o.a.createElement("option",{key:e.value,value:e.value},e.label)})),3===+t.forma_pago?o.a.createElement("div",null,t.store.datosTransferencia&&o.a.createElement(v.v,{style:{textAlign:"left"},variant:"body1"},t.store.datosTransferencia),o.a.createElement(v.u,(e={label:"Comprobante de Transacci\xf3n",variant:"outlined",value:t.numeroTransaccion||"",placeholder:"Agrega tu # de Comprobante",name:"numeroTransaccion",onChange:t.onInputChange,type:"phone"},Object(w.a)(e,"variant","outlined"),Object(w.a)(e,"style",{width:"95%",margin:"auto",marginBottom:10,marginTop:10}),e))):null)}}]),t}(o.a.PureComponent);var ie=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={loading:!1},e.onMounted&&e.onMounted(e.stepIndex),a.handleReturnToOrder=a.handleReturnToOrder.bind(Object(g.a)(Object(g.a)(a))),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"handleReturnToOrder",value:function(){this.props.history.push("/1")}},{key:"render",value:function(){var e=this.props,t=e.loading,a=e.error,n=Object(l.a)(e,["loading","error"]);return o.a.createElement("div",{style:{textAlign:"center",overflow:"auto",padding:10}},t?o.a.createElement(le,null):a?o.a.createElement(ce,Object.assign({},a,{onClick:this.handleReturnToOrder})):o.a.createElement(se,n))}}]),t}(o.a.Component);function le(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(v.d,{size:50}),o.a.createElement(v.v,{variant:"h6"},"Guardando..."))}function ce(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(v.v,{variant:"h6",color:"secondary"},"Ocurri\xf3 un problema al guardar tu orden. Regresa al pedido, verifica tu informaci\xf3n e intentalo nuevamente."),o.a.createElement(v.v,{variant:"body1",color:"secondary"},e.message),o.a.createElement(v.v,{variant:"caption",color:"secondary"},e.code,e.status&&" | "+e.status),e.statusText&&o.a.createElement(v.v,{variant:"body1",color:"secondary"},e.statusText),o.a.createElement(v.a,{onClick:e.onClick,variant:"outlined",color:"primary",fullWidth:!0,style:{marginTop:20}},"REGRESAR AL PEDIDO ",o.a.createElement(E.f,null)))}function se(e){var t=function(e){var t=e.ws_phone,a=e.ws_msg,n=e.contactData,o=e.orderNumber;if(!t||!a)return"";var r=a.replace(/__NAME__/g,(n||{}).nombre).replace(/__ORDER_NUMBER__/g,o||"");return"https://api.whatsapp.com/send?"+"phone=".concat(t,"&")+"text=".concat(encodeURIComponent(r))}(e);return o.a.createElement(o.a.Fragment,null,o.a.createElement(E.d,{fontSize:"large",style:{margin:20}}),o.a.createElement(v.v,{variant:"h5"},"Tu pedido ha sido recibido!"),o.a.createElement(v.v,{variant:"body2",style:{maxWidth:300,margin:"auto",textAlign:"center"}},"Nos comunicaremos contigo para coordinar la entrega de tu pedido.Mantente pendiente a tu telefono."),o.a.createElement(v.a,{onClick:function(e){return window.location.replace(window.location.pathname)},style:{margin:10},variant:"contained",color:"primary"},"NUEVO PEDIDO"),t&&o.a.createElement(v.a,{target:"_blank",style:{margin:10},variant:"outlined",color:"secondary",component:"a",href:t},"CHATEA CON NOSOTROS",o.a.createElement("img",{alt:"Whatsapp",src:"./ws.png",style:{height:20,width:20,marginLeft:5}})))}var de=function(e,t){return function(a){function n(e){var a;return Object(d.a)(this,n),(a=Object(h.a)(this,Object(m.a)(n).call(this,e))).state={render:!0},e.onMount(t),a}return Object(p.a)(n,a),Object(u.a)(n,[{key:"render",value:function(){return this.state.render?o.a.createElement(e,Object.assign({stepIndex:t},this.props)):null}}]),n}(o.a.Component)};function ue(e,t){if(0===e){var a=t.direccion;if(!a.position)return"Confirme su ubicaci\xf3n en el mapa.";if(!a.direccion)return"Digite su direcci\xf3n.";if(!a.referencia)return"Agregue la referencia de la direcci\xf3n de entrega."}if((1===e||2===e)&&!t.items.length)return"Para continuar seleccione al menos un producto";if(2===e&&"ACTIVO"!==t.store.estado&&!t.envio_programado)return"Debido a que la tienda no esta disponible en este momento, necesitas programar una fecha de entrega";if(3===e&&t.contactData){var n=t.contactData;if(!n.nombre)return"Agregue un nombre de contacto";if(!n.telefono)return"Agregue un telefono de contacto";if(t.store.requireContactCedula){if(!n.identificacion)return"Agregue el n\xfamero de identificaci\xf3n de contacto";if(o=H(n.identificacion,n.documento))return o}var o=q.tel(n.telefono);if(o)return o;if(o=q.email(n.email))return o}if(4===e){if(!t.forma_pago)return"Seleccione su m\xe9todo de pago";if(3===+t.forma_pago&&!t.numeroTransaccion)return"Agregue el n\xfamero de Comprobante"}}var he=function(e){return o.a.createElement("div",{style:{width:"calc(100% - 20px)",display:"flex",flexDirection:"row",textAlign:"center",margin:10,minHeight:40}},0===e.activeStep?null:o.a.createElement(v.a,{onClick:e.onBackClick,title:"Regresar",color:"secondary",variant:"outlined"},o.a.createElement(E.c,null)),o.a.createElement(v.a,{onClick:e.onNextClick,disabled:e.disabled,color:"primary",type:"button",variant:"outlined",style:{flex:1},size:"large"},"CONTINUAR"))},me=de(ne,0),pe=de(A,1),ge=de(z,2),ve=de(K,3),fe=de(re,4),be=de(ie,5),Ee=[{t:"Ingresa tu ubicaci\xf3n",resumido:"Ubicaci\xf3n",icon:E.n,currentIcon:E.m},{t:"Elige tus productos",resumido:"Elige",icon:E.b,currentIcon:E.r},{t:"Confirma tu pedido",resumido:"Confirma",icon:E.p,currentIcon:E.o},{t:"Datos de Contacto",resumido:"Contacto",icon:E.l,currentIcon:E.k},{t:"M\xe9todo de Pago",resumido:"Pago",icon:E.j,currentIcon:E.i}],ye=Object(f.h)(function(e){function t(e){var a;(Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state=new S,a.handleItemChange=a.handleItemChange.bind(Object(g.a)(Object(g.a)(a))),a.handleInputChange=a.handleInputChange.bind(Object(g.a)(Object(g.a)(a))),a.handleInvoiceDataChange=a.handleInvoiceDataChange.bind(Object(g.a)(Object(g.a)(a))),a.handleMount=a.handleMount.bind(Object(g.a)(Object(g.a)(a))),a.handleNext=a.handleNext.bind(Object(g.a)(Object(g.a)(a))),a.handleBack=a.handleBack.bind(Object(g.a)(Object(g.a)(a))),a.handleDataChange=a.handleDataChange.bind(Object(g.a)(Object(g.a)(a))),I("contactData")&&(a.state.contactData=I("contactData")),a.state.store=e.store,e.direccion)&&(ue(0,Object(s.a)({},a.state,{direccion:e.direccion}))||(a.state.direccion=e.direccion,e.history.push("/1")));return a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"handleMount",value:function(e){var t=this;if(this.state.orderNumber&&5!==e){var a=Object(s.a)({},new S,{loading:!1,productList:Object(c.a)(this.state.productList)});return a.contactData=I("contactData")||{},a.invoiceData=null,a.delivery=null,this.setState(a),this.props.history.push("/"+a.activeStep),0}var n=e-1,o=void 0;if(e>=0)for(;n>=0;){ue(n,this.state)&&(o=n),n--}if(o>=0)return this.props.history.push("/"+o);if(e>0){if(!this.state.delivery)return console.info("No hay costo de envio, verificando la cobertura"),this.VerificarUbicacion();if((1===e||2===e)&&!this.state.productList.length)return console.info("No hay productos en la lista, obteniendo productos"),this.LoadProducts()}if(5===e){if(this.state.orderNumber||this.state.loading)return;if(this.PROMISE_GUARDAR)return;this.setState({loading:"guardar",errGuardar:null}),this.PROMISE_GUARDAR=x.SaveOrder(this.state).then(function(e){t.setState({loading:!1,orderNumber:e.numero,errGuardar:null},function(){t.PROMISE_GUARDAR=null})}).catch(function(e){t.setState({loading:!1,errGuardar:e},function(){t.PROMISE_GUARDAR=null})})}this.setState({activeStep:e})}},{key:"handleDataChange",value:function(e,t){this.setState(function(a){var n=Object(s.a)({},a);if("direccion"===e){var o=n[e].position,r=t?t.position:null;r&&o&&o.lat===r.lat&&o.lng===r.lng||(n.delivery&&console.info("App.State borrando DELIVERY:",n.delivery),n.delivery=null)}return n[e]=t,n})}},{key:"LoadProducts",value:function(){var e=this;if(!this.state.productList.length)return this.setState({loading:!0,loadingMessage:"Obteniendo los productos de la tienda...",error:null}),x.GetProducts().then(function(t){var a=t.map(function(t){var a=0;return t.pvp&&(a=t.pvp),t.pagaIva&&e.state.store.porcentajeIVA&&(a+=t.pvp*+e.state.store.porcentajeIVA/100),t.pvp_final=a,t});e.setState({productList:a,loading:null,loadingMessage:null},function(){return console.info("Se han cargado los productos al estado")})}).catch(function(t){if(console.dir(t),404===t.status)return e.setState({loading:null,loadingMessage:null,productList:[],error:{message:"Esta tienda no tiene ningun articulo publicado."}});e.setState({loading:null,loadingMessage:null,error:Object(s.a)({},t)})});console.warn("Load Products LOADED MORE THAN ONCE")}},{key:"VerificarUbicacion",value:function(){var e=this,t=this.state.direccion;return this.setState({loading:!0,loadingMessage:"Verifcando el \xe1rea de cobertura. Espera un momento.",error:null,delivery:null}),x.CheckCoverage(t.position).then(function(a){if(a.isCovered)return e.setState({direccion:Object(s.a)({},t),delivery:{status:a.deliveryPriceStatus,valor:a.deliveryPrice,metros:a.distance,segundos:a.duration,info_id:a.info_id},loading:null,loadingMessage:null});a.nearestStore?(setTimeout(function(){x.RedirectTo(a.nearestStore,t)},100),e.setState({error:{message:"Estamos dirigiendote a la tienda m\xe1s cercana a ti.",action:function(){},btnMessage:"ESPERA UN MOMENTO"},loading:null,loadingMessage:null})):e.setState({error:{message:"Esta tienda no est\xe1 disponible para tu \xe1rea. Intenta con otra ubicaci\xf3n.",btnMessage:"CAMBIAR UBICACI\xd3N",action:function(){e.props.history.push("/0"),e.setState({error:null,loading:null,loadingMessage:null})}}})}).catch(function(t){return e.setState({error:t})})}},{key:"handleInputChange",value:function(e){var t=e.currentTarget,a=t.name,n=t.value;this.setState(function(e){var t=Object(s.a)({},e);if(a.indexOf(".")>=0){for(var o=a.split("."),r=o.pop(),i=t,l=0;l<o.length;l++)i=i[o[l]];i[r]=n}else t[a]=n;return t})}},{key:"handleItemChange",value:function(e){var t=this.state.items.find(function(t){return t.id===e.id});if(!t&&e.cantidad){var a=Object(c.a)(this.state.items);return a.push(e),this.setState({items:a})}if(t){var n=Object(c.a)(this.state.items),o=n.indexOf(t);e.cantidad?n[o]=e:n.splice(o,1),this.setState({items:n})}}},{key:"handleInvoiceDataChange",value:function(e){this.setState({invoiceData:e})}},{key:"handleNext",value:function(){var e=this.state,t=e.contactData,a=e.direccion,n=e.activeStep,o=ue(n,this.state);if(o)return alert(o);if(0===n&&a){a.gps_enabled;var r=Object(l.a)(a,["gps_enabled"]);D("direccion",JSON.stringify(r))}3===n&&t&&D("contactData",JSON.stringify(t)),this.props.history.push("/"+(this.state.activeStep+1))}},{key:"handleBack",value:function(){this.props.history.push("/"+(this.state.activeStep-1))}},{key:"render",value:function(){var e=this,t=this.state,a=t.activeStep,n=t.productList,r=t.loading,i=t.loadingMessage,l=t.error,c=t.store,s=t.items,d=t.nota,u=t.forma_pago,h=t.numeroTransaccion,m=t.invoiceData,p=t.contactData,g=t.direccion,b=t.errGuardar,E=t.orderNumber;return o.a.createElement(v.q,{style:{maxHeight:"100%",minHeight:"100%",margin:"auto",maxWidth:700,display:"flex",flexDirection:"column"}},o.a.createElement(v.t,{className:"hide-on-min-height",alternativeLabel:!0,activeStep:a},Ee.map(function(e,t){return function(e,t,a){var n={};a===t&&(n={icon:o.a.createElement(e.currentIcon,null)});t>a&&(n={icon:o.a.createElement(e.icon,null)});return o.a.createElement(v.r,{key:t},o.a.createElement(v.s,n,e.resumido))}(e,t,a)})),o.a.createElement(v.v,{variant:"h6",className:"show-on-min-height",style:{textAlign:"center",textTransform:"uppercase",background:"#3f51b5",paddingTop:5,paddingBottom:5,color:"white"}},(Ee[a]||{}).t),o.a.createElement("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"}},l?o.a.createElement("div",{style:{flex:1,textAlign:"center",padding:20}},o.a.createElement(v.v,{variant:"h6",color:"secondary"},l.message),o.a.createElement(v.a,{fullWidth:!0,style:{marginTop:20,marginBottom:20},onClick:function(){l.action?l.action():window.location.reload()},variant:"outlined",color:"primary"},l.btnMessage||"REINTENTAR")):r?o.a.createElement("div",{style:{flex:1,textAlign:"center",padding:20}},o.a.createElement(v.d,{size:40}),o.a.createElement(v.v,{color:"primary",variant:"h6"},i)):o.a.createElement(o.a.Fragment,null,r&&o.a.createElement(f.a,{message:"Hay un proceso en progreso, no deberia salir hasta que se complete. Est\xe1 seguro de salir?"}),o.a.createElement(f.e,null,o.a.createElement(f.c,{path:"/0",render:function(t){return o.a.createElement(me,Object.assign({},t,{style:{flex:1},store:c,onDataChange:e.handleDataChange,onMount:e.handleMount,data:g,prop:"direccion"}))}}),o.a.createElement(f.c,{path:"/1",render:function(t){return o.a.createElement(pe,Object.assign({},t,{style:{flex:1},onMount:e.handleMount,onItemChange:e.handleItemChange,choosenItems:s,productList:n}))}}),o.a.createElement(f.c,{path:"/2",render:function(t){return o.a.createElement(ge,Object.assign({},t,{style:{flex:1},productList:n,delivery:e.state.delivery,envio_programado:e.state.envio_programado,onMount:e.handleMount,onItemChange:e.handleItemChange,onInputChange:e.handleInputChange,onDataChange:e.handleDataChange,items:s,nota:d,store:c}))}}),o.a.createElement(f.c,{path:"/3",render:function(t){return o.a.createElement(ve,Object.assign({},t,{requireContactCedula:c&&c.requireContactCedula,onMount:e.handleMount,invoiceData:m,data:p,onInputChange:e.handleInputChange,onInvoiceDataChange:e.handleInvoiceDataChange}))}}),o.a.createElement(f.c,{path:"/4",render:function(t){return o.a.createElement(fe,Object.assign({},t,{onMount:e.handleMount,onInputChange:e.handleInputChange,numeroTransaccion:h,forma_pago:u,store:c}))}}),o.a.createElement(f.c,{path:"/5",render:function(t){return o.a.createElement(be,Object.assign({},t,{ws_msg:c.ws_msg,ws_phone:c.ws_phone,contactData:p,orderNumber:E,onMount:e.handleMount,loading:r,error:b,saved:Boolean(E)}))}}),o.a.createElement(f.b,{exact:!0,from:"/",to:"/0"}),o.a.createElement(f.b,{exact:!0,from:"",to:"/0"})),Ee.length>this.state.activeStep&&o.a.createElement(he,{onNextClick:this.handleNext,onBackClick:this.handleBack}))))}}]),t}(o.a.Component));var Oe,Ce=function(e){return o.a.createElement(b.a,null,o.a.createElement(ye,e))},je=function(e){function t(e){var a;Object(d.a)(this,t),(a=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={};var n=e.store,o=e.error;return n?(a.state.logoSrc=n.logoSrc,a.state.slogan=n.slogan,a.state.titulo=n.titulo,"NO_DISPONIBLE"===n.estado?(a.state.error="La tienda no se encuentra disponible por el momento. Intenta nuevamente despu\xe9s.",a.state.horarios_de_atencion=N(n.horarios),a.state.horarios_de_atencion&&a.state.horarios_de_atencion.length&&(a.state.infoHeader+="\nHorarios de Atenci\xf3n:")):"CERRADO"===n.estado?(a.state.infoHeader="La tienda se encuentra cerrada en este momento, pero a\xfan puedes agregar tu pedido para otro d\xeda.",a.state.horarios_de_atencion=N(n.horarios),a.state.horarios_de_atencion&&a.state.horarios_de_atencion.length&&(a.state.infoHeader+="\nHorarios de Atenci\xf3n:")):"DESHABILITADO"===n.estado&&(a.state.error="Esta tienda est\xe1 DESHABILITADA y no recibe pedidos.",a.state._error="Ingresaste a: "+window.location.href)):o&&(404===o.status?(a.state.error="La tienda que buscas no existe. Revisa tu enlace.",a.state._error="Ingresaste a: "+window.location.href):(a.state.error=o.message,a.state.code=o.code||o.status,a.state._error=o.statusText)),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.logoSrc,n=t.slogan,r=t.titulo,i=t.error,l=t._error,c=t.horarios_de_atencion,s=t.infoHeader;return o.a.createElement("div",{style:{width:"calc(100% - 20px)",maxWidth:600,textAlign:"center",paddingTop:30,margin:"auto"}},i?o.a.createElement(o.a.Fragment,null,o.a.createElement(v.v,{color:"secondary",variant:"h6"},i),o.a.createElement(v.v,{color:"secondary",variant:"subtitle2"},l)):o.a.createElement(o.a.Fragment,null,a&&o.a.createElement("img",{src:a,style:{maxWidth:"100%",maxHeight:250,marginTop:10,marginBottom:10},alt:r||""}),o.a.createElement(v.v,{variant:"h5"},r||"Cargando..."),n&&o.a.createElement(v.v,{variant:"subtitle2"},n),s&&c&&o.a.createElement(v.h,null),s&&o.a.createElement(v.v,{color:"secondary",variant:"h6"},s),c&&c.map(function(e,t){return o.a.createElement(v.v,{key:t,color:"secondary",variant:"subtitle1",style:{flex:1,textAlign:"center"}},e.dias," ",e.periodo)}),(r||a)&&o.a.createElement(v.a,{color:"primary",onClick:function(t){return e.props.launch(e.props)},fullWidth:!0,variant:"outlined",style:{marginTop:20}},"EMPECEMOS!")))}}]),t}(o.a.Component);if(window.location.search&&window.URLSearchParams){var xe=new URLSearchParams(window.location.search),De=xe&&xe.get("step1");try{De=atob(De)&&JSON.parse(atob(De))}catch(ke){De=null}Oe=De}function Ie(e){i.a.render(o.a.createElement(Ce,e),document.getElementById("app"))}function Se(e){i.a.render(o.a.createElement(je,Object.assign({},e,{launch:Ie})),document.getElementById("app"))}x.GetStoreData().then(function(e){return"DISPONIBLE"===e.estado&&Oe?Ie({store:e,direccion:Oe}):Se({store:e,direccion:Oe})}).catch(function(e){Se({error:e})})}},[[5564,2,1]]]);
//# sourceMappingURL=main.29f4ff0d.chunk.js.map